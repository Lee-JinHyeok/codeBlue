<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  

<mapper namespace="com.example.codeblue.test.jjw.JJWMapper">
	
	<!-- User 객체 -->
	<resultMap type="com.example.codeblue.vo.User" id="User"> 
		<!-- column은 테이블에서의 칼럼명  property는 클레스의 필드명 -->
		<result column="user_id" property="userId" ></result>
		<result column="user_name" property="userName" ></result>
		<result column="user_pw" property="userPw"></result>
		<result column="user_birthdate" property="userBirthdate" ></result>
		<result column="user_createtime" property="userCreatetime"></result>
		<result column="user_authority" property="userAuthority" ></result>
		
		<association property="region" resultMap="Region">
		</association>
		<association property="rank" resultMap="Rank">
		</association>
	</resultMap>
	
	<!-- InquiryHistory 객체  -->
	<resultMap type="com.example.codeblue.vo.InquiryHistory" id="InquiryHistory"> 
	<!-- column은 테이블에서의 칼럼명  property는 클레스의 필드명 -->
		<result column="inquiry_history_id" property="inquiryHistoryId" ></result>
		<result column="inquiry_title" property="inquiryTitle" ></result>
		<result column="inquiry_content" property="inquiryContent" ></result>
		<result column="inquiry_datetime" property="inquiryDatetime"></result>
	   
		<association property="inquiry" resultMap="Inquiry">
	   	</association>
	   	<association property="user" resultMap="User">
	   	</association>
	</resultMap>
	
	<!-- ReportHistory 객체  -->
	<resultMap type="com.example.codeblue.vo.ReportHistory" id="ReportHistory"> 
	<!-- column은 테이블에서의 칼럼명  property는 클레스의 필드명 -->
	   	<result column="report_history_id" property="reportHistoryId" ></result>
	   	<result column="report_title" property="reportTitle" ></result>
	   	<result column="report_content" property="reportContent" ></result>
	   	<result column="report_datetime" property="reportDatetime"></result>
	   
	   	<association property="report" resultMap="Report">
	  	</association>
	  	<association property="user" resultMap="User">
	   	</association>
	</resultMap>
	
	<!-- NoticeBoard 객체 -->
	<resultMap type="com.example.codeblue.vo.NoticeBoard" id="NoticeBoard">
		<result column="notice_id" property="noticeId"></result>
		<result column="notice_title" property="noticeTitle"></result>
		<result column="notice_content" property="noticeContent"></result>
		<result column="notice_datetime" property="noticeDatetime"></result>
	</resultMap>
	
	<!-- QuestionBoard 객체 -->
	<resultMap type="com.example.codeblue.vo.QuestionBoard" id="QuestionBoard"> 
		<!-- column은 테이블에서의 칼럼명  property는 클레스의 필드명 -->
		<result column="question_id" property="questionId" ></result>
		<result column="question_title" property="questionTitle" ></result>
		<result column="question_content" property="questionContent" ></result>
		<result column="question_datetime" property="questionDatetime"></result>
		<result column="answer_count" property="answerCount"></result>
		<result column="comment_count" property="commentCount"></result>
		<result column="vote_count" property="voteCount"></result>
		<association property="user" resultMap="User">
		</association>	
		<association property="feild" resultMap="Feild">
		</association>
		<association property="tag" resultMap="Tag">
		</association>
	</resultMap>
	<!-- Rank 객체 -->
	<resultMap type="com.example.codeblue.vo.Rank" id="Rank">
		<result column="rank_id" property="rankId"></result>
		<result column="rank_name" property="rankName"></result>
	</resultMap>
	
	<!-- Region 객체 -->
	<resultMap type="com.example.codeblue.vo.Region" id="Region">
		<result column="region_id" property="regionId"></result>
		<result column="region_name" property="regionName"></result>
	</resultMap>
	
	<!-- Inquiry 객체 -->
	<resultMap type="com.example.codeblue.vo.Inquiry" id="Inquiry">
		<result column="inquiry_id" property="inquiryId"></result>
	    <result column="inquiry_name" property="inquiryName"></result>
	</resultMap>
	
	<!-- Report 객체 -->
	<resultMap type="com.example.codeblue.vo.Report" id="Report">
		<result column="report_id" property="reportId"></result>
	     <result column="report_name" property="reportName"></result>
	</resultMap>
	
	<!-- Tag 객체 -->
	<resultMap type="com.example.codeblue.vo.Tag" id="Tag">
		<result column="tag_id" property="tagId"></result>
		<result column="tag_name" property="tagName"></result>
	</resultMap>
	
	<!-- Feild 객체 -->
	<resultMap type="com.example.codeblue.vo.Feild" id="Feild">
		<result column="feild_id" property="feildId"></result>
		<result column="feild_name" property="feildName"></result>
	</resultMap>
	
	<!-- QuestionCount 객체 -->
	<resultMap type="com.example.codeblue.vo.QuestionCount" id="QuestionCount">
		<result column="question_date" property="questionDate"></result>
		<result column="question_month" property="questionMonth"></result>
		<result column="count" property="questionCount"></result>
		<result column="feild_id" property="feildId"></result>
	</resultMap>
	
	<!-- Hospital 객체 -->
	<resultMap type="com.example.codeblue.vo.Hospital" id="Hospital">
		<!-- pk는 id 그 외는 result칼럼사용 -->
		<!-- column은 테이블에서의 칼럼명  property는 클레스의 필드명 -->
		<result column="hospital_id" property="hospitalId"></result>
		<result column="hospital_name" property="hospitalName"></result>
		<result column="hospital_number" property="hospitalNumber"></result>
		<result column="hospital_address" property="hospitalAddress"></result>
		<result column="hospital_address2" property="hospitalAddress2"></result>
		<association property="region" javaType="com.example.codeblue.vo.Region">
			<result column="region_id" property="regionId"></result>
			<result column="region_name" property="regionName"></result>
		</association>
	</resultMap>
	<!-- ServiceCategory 객체 -->
	<resultMap type="com.example.codeblue.vo.ServiceCategory" id="ServiceCategory">
		<result column="service_category_id" property="serviceCategoryId"></result>
		<result column="service_category_name" property="serviceCategoryName"></result>
	</resultMap>
	<!-- Answer 객체 -->
	<resultMap type="com.example.codeblue.vo.Answer" id="Answer">
		<result column="answer_id"></result>
		<result column="answer_content"></result>
		<result column="answer_datetime"></result>
		<association property="questionBoard" resultMap="QuestionBoard"></association>
		<association property="user" resultMap="User"></association>
	</resultMap>
	<!-- 객체정리 끝ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ -->
	<!-- 삭제된 게시글 전체행수 -->
	<select id="selectWithdrawQuestionBoardTotalCount" resultType="int" parameterType="com.example.codeblue.vo.Page">
		SELECT 
			COUNT(*)
		FROM withdraw_question_board q INNER JOIN feild fe
		ON q.feild_id = fe.feild_id
		WHERE question_id is not null
			<if test="searchWord != null">
				AND question_title like CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchCategory != null">
				AND fe.feild_id = #{searchCategory}
			</if>
			<if test="toDate != null and fromDate != null">
				AND q.question_datetime &gt;= #{toDate} AND q.question_datetime &lt;= #{fromDate}
			</if>
	</select>
	
	<!-- 삭제된 게시글 가져오기 -->
	<select id="selectWithdrawQuestionBoardList" resultMap="QuestionBoard" parameterType="com.example.codeblue.vo.Page">
		SELECT 
				q.question_id,
				q.question_title,
				q.question_datetime,
				q.question_content,
				q.user_id,
				fe.feild_name,
				fe.feild_id
		FROM withdraw_question_board q LEFT JOIN feild fe
		ON q.feild_id = fe.feild_id
		WHERE q.question_id IS NOT NULL
			<if test="searchWord != null">
				AND	question_title like CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchCategory != null">
				AND fe.feild_id = #{searchCategory}
			</if>
			<if test="toDate != null and fromDate != null">
				AND q.question_datetime &gt;= #{toDate} AND q.question_datetime &lt;= #{fromDate}
			</if>
		LIMIT #{beginRow},#{rowPerPage}
	</select>

	<!-- 질문 삭제 -->
	<delete id="deleteQuestionBoard" parameterType="java.util.List">
		DELETE FROM question_board
		WHERE question_id IN
		<foreach collection="list" item="item" index="index" separator="," open="(" close=")">
			(#{item})
		</foreach>
	</delete>
	<!-- 질문에 해당하는 quesiton_board_img 삭제 -->
	<delete id="deleteQuestionBoardImg" parameterType="java.util.List">
		DELETE FROM question_board_img
		WHERE question_id IN
		<foreach collection="list" item="item" index="index" separator="," open="(" close=")">
			(#{item})
		</foreach>	
	</delete>
	<!-- 질문에 해당하는 question_comment 삭제 -->
	<delete id="deleteQuestionComment" parameterType="java.util.List">
		DELETE FROM question_comment
		WHERE question_id IN
		<foreach collection="list" item="item" index="index" separator="," open="(" close=")">
			(#{item})
		</foreach>	
	</delete>
	<!-- 질문에 해당하는 question_vote 삭제 -->
	<delete id="deleteQuestionVote" parameterType="java.util.List">
		DELETE FROM question_vote
		WHERE question_id IN
		<foreach collection="list" item="item" index="index" separator="," open="(" close=")">
			(#{item})
		</foreach>	
	</delete>
	<!-- 질문 지우는조건에 해당하는 answer 삭제 -->
	<delete id="deleteQuestionBoardAnswer" parameterType="java.util.List">
		DELETE FROM answer
		WHERE answer_id IN
		<foreach collection="list" item="item" index="index" separator="," open="(" close=")">
			(#{item})
		</foreach>	
	</delete>
	<!-- 질문 지우는조건에 해당하는 answer_comment 삭제 -->
	<delete id="deleteQuestionBoardAnswerComment" parameterType="java.util.List">
		DELETE FROM answer_comment
		WHERE answer_id IN
		<foreach collection="list" item="item" index="index" separator="," open="(" close=")">
			(#{item})
		</foreach>
	</delete>
	<!-- 질문 지우는조건에 해당하는 answer_vote 삭제 -->
	<delete id="deleteQuestionBoardAnswerVote" parameterType="java.util.List">
		DELETE FROM answer_vote
		WHERE answer_id IN
		<foreach collection="list" item="item" index="index" separator="," open="(" close=")">
			(#{item})
		</foreach>
	</delete>
	<!-- 체크한 질문 리스트 다른 테이블에 저장 -->
	<insert id="insertWithdrawQuestionBoard" parameterType="java.util.List">
		INSERT INTO withdraw_question_board
			(
				question_id,
				question_title,
				question_content,
				question_datetime,
				feild_id,
				user_id,
				tag_id
			) VALUES
			<foreach collection="list" item="item" index="index" separator=",">
				(
					#{item.questionId},
					#{item.questionTitle},
					#{item.questionContent},
					#{item.questionDatetime},
					#{item.feild.feildId},
					#{item.user.userId},
					#{item.tag.tagId}
				)
			</foreach>
	</insert>
	<!-- 질문에 해당되는 답변Id 값 가져오기 -->
	<select id="selectQuestionBoardAnswerList" resultType="String" parameterType="java.util.List">
		SELECT 
			answer_id
		FROM answer
		WHERE question_id IN
		<foreach collection="list" item="item" index="index" separator="," open="(" close=")">
			(#{item})
		</foreach>	
	</select>
	<!-- 체크한 질문 리스트 값 가져오기 -->
	<select id="selectQuestionBoardCheckList" resultMap="QuestionBoard" parameterType="java.util.List">
		SELECT
			question_id,
			question_title,
			question_content,
			question_datetime,
			feild_id,
			user_id,
			tag_id
		FROM question_board
		WHERE question_id IN
		<foreach collection="list" item="item" index="index" separator="," open="(" close=")">
			(#{item})
		</foreach>
	</select>
	
<!-- 	<select id="selectFeildList" resultMap="Feild"> -->
<!-- 		SELECT  -->
<!-- 			feild_id, -->
<!-- 			feild_name  -->
<!-- 		FROM feild -->
<!-- 	</select> -->
	
<!-- 	<select id="selectQuestionBoardTotalCount" resultType="int" parameterType="com.example.codeblue.vo.Page"> -->
<!-- 		SELECT  -->
<!-- 			COUNT(*) -->
<!-- 		FROM question_board q INNER JOIN feild fe -->
<!-- 		ON q.feild_id = fe.feild_id -->
<!-- 		WHERE question_id is not null -->
<!-- 			<if test="searchWord != null"> -->
<!-- 				AND question_title like CONCAT('%',#{searchWord},'%') -->
<!-- 			</if> -->
<!-- 			<if test="searchCategory != null"> -->
<!-- 				AND fe.feild_id = #{searchCategory} -->
<!-- 			</if> -->
<!-- 			<if test="toDate != null and fromDate != null"> -->
<!-- 				AND q.question_datetime &gt;= #{toDate} AND q.question_datetime &lt;= #{fromDate} -->
<!-- 			</if> -->
<!-- 	</select> -->
	
<!-- 	<select id="selectQuestionBoardList" resultMap="QuestionBoard" parameterType="com.example.codeblue.vo.Page"> -->
<!-- 		SELECT  -->
<!-- 				q.question_id, -->
<!-- 				q.question_title, -->
<!-- 				q.question_datetime, -->
<!-- 				q.question_content, -->
<!-- 				q.user_id, -->
<!-- 				CASE WHEN a.answer_count IS NULL then 0 ELSE a.answer_count END AS answer_count, -->
<!-- 				fe.feild_name, -->
<!-- 				fe.feild_id -->
<!-- 		FROM question_board q left JOIN (SELECT COUNT(*) AS answer_count,question_id FROM -->
<!-- 		answer -->
<!-- 		GROUP BY question_id) a -->
<!-- 		ON q.question_id = a.question_id -->
<!-- 		LEFT JOIN feild fe -->
<!-- 		ON q.feild_id = fe.feild_id -->
<!-- 		WHERE q.question_id IS NOT NULL -->
<!-- 			<if test="searchWord != null"> -->
<!-- 				AND	question_title like CONCAT('%',#{searchWord},'%') -->
<!-- 			</if> -->
<!-- 			<if test="searchCategory != null"> -->
<!-- 				AND fe.feild_id = #{searchCategory} -->
<!-- 			</if> -->
<!-- 			<if test="toDate != null and fromDate != null"> -->
<!-- 				AND q.question_datetime &gt;= #{toDate} AND q.question_datetime &lt;= #{fromDate} -->
<!-- 			</if> -->
<!-- 		LIMIT #{beginRow},#{rowPerPage} -->
<!-- 	</select> -->
</mapper>