<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.example.codeblue.test.hyol.HyolMapper">
	<!-- User 객체 -->
	<resultMap type="com.example.codeblue.vo.User" id="User"> 
		<!-- column은 테이블에서의 칼럼명  property는 클레스의 필드명 -->
		<result column="user_id" property="userId" ></result>
		<result column="user_name" property="userName" ></result>
		<result column="user_pw" property="userPw"></result>
		<result column="user_birthdate" property="userBirthdate" ></result>
		<result column="user_createtime" property="userCreatetime"></result>
		<result column="user_activity" property="userActivity"></result>
		
		<association property="region" resultMap="Region">
		</association>
		<association property="rank" resultMap="Rank">
		</association>
	</resultMap>
	<!-- Expert 객체 -->
	<resultMap type="com.example.codeblue.vo.Expert" id="Expert">
		<result column="expert_license_no" property="expertLicenseNo"></result>
		<result column="expert_license_issue_date" property="expertLicenseIssueDate"></result>
		
		<association property="feild" resultMap="Feild">
		</association>
		<association property="user" resultMap="User">
		</association>
	</resultMap>
	<!-- Rank 객체 -->
	<resultMap type="com.example.codeblue.vo.Rank" id="Rank">
		<result column="rank_id" property="rankId"></result>
		<result column="rank_name" property="rankName"></result>
	</resultMap>
	
	<!-- Region 객체 -->
	<resultMap type="com.example.codeblue.vo.Region" id="Region">
		<result column="region_id" property="regionId"></result>
		<result column="region_name" property="regionName"></result>
	</resultMap>
	<!-- Feild 객체 -->
	<resultMap type="com.example.codeblue.vo.Feild" id="Feild">
		<result column="feild_id" property="feildId"></result>
		<result column="feild_name" property="feildName"></result>
	</resultMap>
	<!-- 유저리스트 -->
	<select id="adminSelectUserList" parameterType="com.example.codeblue.vo.Page" resultMap="User">
		select
			u.user_id,
			u.user_name,
			re.region_id,
			re.region_name,
			u.user_birthdate,
			u.user_createtime,
			ra.rank_id,
			ra.rank_name,
			u.user_activity
		from user u inner join region re INNER JOIN rank ra
		ON u.region_id = re.region_id AND u.rank_id = ra.rank_id
		where u.user_activity = 'Y'
			<if test="searchWord != null">
				and u.user_name like CONCAT('%',#{searchWord},'%')
			</if>
			<if test="toDate != null and fromDate != null">
			AND DATE(user_createtime) &gt;= DATE(#{toDate}) AND DATE(user_createtime) &lt;= DATE(#{fromDate})
			</if>
		order by u.user_createtime DESC
		limit #{beginRow},#{rowPerPage}
	</select>
	<!-- 유저리스트 카운팅 -->
	<select id="adminSelectUserCount" parameterType="com.example.codeblue.vo.Page" resultType="int">
		SELECT
			COUNT(*)
		FROM user
		WHERE user_activity = 'Y'
		<if test="searchWord != null">
			AND user_name LIKE CONCAT('%',#{searchWord},'%')
		</if>
		<if test="toDate != null and fromDate != null">
			AND DATE(user_createtime) &gt;= DATE(#{toDate}) AND DATE(user_createtime) &lt;= DATE(#{fromDate})
		</if>
	</select>

	<!-- 유저삭제(y->n) -->
	<update id="adminDeleteUser" parameterType="java.util.List">
		UPDATE user
		SET user_activity = 'N'
		WHERE user_id in
		<foreach collection="list" item="type" index="index" open="(" close=")" separator=",">
			(#{type})
		</foreach>
	</update>
	<!-- 탈퇴회원 조회 -->
	<select id="adminSelectWithdrawUserList" parameterType="com.example.codeblue.vo.Page" resultMap="User">
		select
			u.user_id,
			u.user_name,
			re.region_id,
			re.region_name,
			u.user_birthdate,
			u.user_createtime,
			ra.rank_id,
			ra.rank_name,
			u.user_activity
		FROM user u inner join region re INNER JOIN rank ra
		ON u.region_id = re.region_id AND u.rank_id = ra.rank_id
		WHERE u.user_activity = 'N'
			<if test="searchWord != null">
				AND u.user_name like CONCAT('%',#{searchWord},'%')
			</if>
			<if test="toDate != null and fromDate != null">
			AND DATE(user_createtime) &gt;= DATE(#{toDate}) AND DATE(user_createtime) &lt;= DATE(#{fromDate})
			</if>
		ORDER BY u.user_createtime DESC
		LIMIT #{beginRow},#{rowPerPage}
	</select>
	<!-- 탈퇴회원 수 -->
	<select id="adminSelectWithdrawUserCount" parameterType="com.example.codeblue.vo.Page" resultType="int">
		SELECT
			COUNT(*)
		FROM user
		WHERE user_activity = 'N'
		<if test="searchWord != null">
			AND user_name LIKE CONCAT('%',#{searchWord},'%')
		</if>
		<if test="toDate != null and fromDate != null">
			AND DATE(user_createtime) &gt;= DATE(#{toDate}) AND DATE(user_createtime) &lt;= DATE(#{fromDate})
		</if>
	</select>
	<!-- 회원 복구 -->
	<update id="adminUpdateWithdrawUser" parameterType="java.util.List">
		UPDATE user
		SET user_activity = 'Y'
		WHERE user_id in
		<foreach collection="list" item="type" index="index" open="(" close=")" separator=",">
			(#{type})
		</foreach>
	</update>
	<!-- 전문가 회원 조회 -->
	<select id="adminSelectExpertUserList" parameterType="com.example.codeblue.vo.Page" resultMap="User">
		select
			u.user_id,
			u.user_name,
			re.region_id,
			re.region_name,
			u.user_birthdate,
			u.user_createtime,
			ra.rank_id,
			ra.rank_name,
			u.user_activity
		from user u inner join region re INNER JOIN rank ra
		ON u.region_id = re.region_id AND u.rank_id = ra.rank_id
		where u.user_activity = 'Y' AND ra.rank_name = 'expert'
			<if test="searchWord != null">
				and u.user_name like CONCAT('%',#{searchWord},'%')
			</if>
			<if test="toDate != null and fromDate != null">
			AND DATE(user_createtime) &gt;= DATE(#{toDate}) AND DATE(user_createtime) &lt;= DATE(#{fromDate})
			</if>
		order by u.user_createtime DESC
		limit #{beginRow},#{rowPerPage}
	</select>
	<!-- 전문가 회원 수 -->
	<select id="adminSelectExpertUserCount" parameterType="com.example.codeblue.vo.Page" resultType="int">
		SELECT
			COUNT(*)
		FROM user u INNER JOIN rank ra
		ON u.rank_id = ra.rank_id
		WHERE u.user_activity = 'Y' AND ra.rank_name = 'expert'
		<if test="searchWord != null">
			AND u.user_name LIKE CONCAT('%',#{searchWord},'%')
		</if>
		<if test="toDate != null and fromDate != null">
			AND DATE(u.user_createtime) &gt;= DATE(#{toDate}) AND DATE(u.user_createtime) &lt;= DATE(#{fromDate})
		</if>
	</select>
	<!-- 유저ㅓㅓㅓㅓㅓㅓㅓㅏㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓㅓ -->
	<!-- 유저 유저조회 -->
	<select id="selectUserList" resultMap="User">
		select
			u.user_id,
			u.user_name,
			re.region_id,
			re.region_name,
			u.user_birthdate,
			u.user_createtime,
			ra.rank_id,
			ra.rank_name,
			u.user_activity
		from user u inner join region re INNER JOIN rank ra
		ON u.region_id = re.region_id AND u.rank_id = ra.rank_id
		where u.user_activity = 'Y'
		<if test="searchWord != null">
			AND user_name like CONCAT('%',#{searchWord},'%')
		</if>
		ORDER BY user_createtime DESC
		LIMIT #{beginRow},#{rowPerPage}
	</select>
	<!-- 유저 유저 수 카운팅 -->
	<select id="selectUserCount" parameterType="com.example.codeblue.vo.Page" resultType="int">
	select
		count(*) 
	from user
	where user_activity = 'Y'
	<if test="searchWord != null">
			AND user_name LIKE CONCAT('%',#{searchWord},'%')
	</if>
	</select>
</mapper>