<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="">

<title>비밀번호 찾기 - 코드블루</title>

<!-- Custom fonts for this template-->
<link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet"
	type="text/css">
<link
	href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
	rel="stylesheet">

<!-- Custom styles for this template-->
<link href="css/sb-admin-2.min.css" rel="stylesheet">
<!-- Custom styles for codeBlue -->
<link href="css/codeBlue.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>

<body style="background: #ebebeb; height: 94vh">
 
		<!-- Topbar -->
		<nav
			class="navbar navbar-expand navbar-light topbar mb-4 shadow fixed-top"
			style="height: 50px; border-bottom: 1px solid #d9d9d9; border-top: 4px solid #4e73df; background: #f2f2f2;">
			<div class="container">
				<!-- topbar codeblue logo -->
				<a class="navbar-brand text-primary mr-0" href="/">
					<img src="/img/codeBlueLogo.png" width="130px"> 
				</a> 
				<a class="btn btn-sm btn-default mx-2 hov-g text-dark" href="/QnA">QnA</a>

				<!-- Topbar Search -->
				<div class="input-group">
					<input type="text" class="form-control  form-control-sm bg-light border-1" placeholder="검색어" style="width: 400px !important">
					<div class="input-group-append">
						<button class="btn btn-primary btn-sm" type="button">
							<i class="fas fa-search fa-sm"></i>
						</button>
					</div>
				</div>

				<div class="d-felx justify-content-end" style="width: 600px">
					<a class="ml-3 btn btn-sm hov-p text-primary" href="/login">로그인</a>
					<a class=" btn ml-1 btn-sm btn-primary" href="/register">회원가입</a>
				</div> 
			</div>
		</nav>
		<!-- End of Topbar -->

		<!-- Begin Page Content -->
		<div class="container" style="height: 100%" align="center">  
			<div class="p-5 m-5 text-left" style="width: 50%"> 
				<p class="text-center">
					<a href="/">
						<img src="/img/codeBlueIcon.png" width="50px"><br>
						<img class="mb-4" src="/img/codeBlue.png" width="100px">
					</a> 
				</p>
				<!-- login Form begin -->
				<div class="card shadow pt-2 px-2 mx-5"> 
					<form class="card-body">
						<small class="mb-2 pb-4">
							비밀번호가 기억이 안나시나요? 이메일을 입력하시면 인증 코드를 보내드립니다! 인증코드로 이메일을 인증하고 비밀번호를 새로 설정해보세요.
						</small>
					  <div class="form-group">
					    <label class="text-dark font-weight-bold" for="id">이메일</label>
					    <input type="email" class="form-control form-control-sm" id="userId" placeholder="E-Mail@example.com"> 
					  </div>  
					  <button type="button" class="btn btn-block btn-primary" id="email">인증 메일 받기</button> 
					</form> 
					<!-- 입력 클릭시 인증코드 입력란 출력 -->
					  <b class="text-sm card mt-3 mx-3 p-3 text-center text-primary shadow" id="notice" style="display:none">인증 메일이 전송 되었습니다!</b>
					  <form class="was-validated card-body" > 
						  <div id="codeForm" style="display:none">	  
						  	<div class="form-group">
						    	<label class="text-dark font-weight-bold" for="code">인증코드</label>
						    	<input type="text" class="form-control" id="code" placeholder="인증코드를 입력해주세요" required> 
						    	<div class="invalid-feedback">인증 코드를 입력해주세요 🎆</div> 
						  	</div> 
						  	<button type="button" id="confirmCode" class="btn btn-block btn-outline-primary">확인</button>  
							<a href="#" id="resend" class="small text-center">메일을 못 받으셨나요? 다시 보내드립니다!</a> 
						  </div>
					  </form> 
				</div> 
			</div> 			
		</div> 
		<!-- Page Content End --> 
		 


	<!-- Bootstrap core JavaScript-->
	<script src="vendor/jquery/jquery.min.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

	<!-- Core plugin JavaScript-->
	<script src="vendor/jquery-easing/jquery.easing.min.js"></script>

	<!-- Custom scripts for all pages-->
	<script src="js/sb-admin-2.min.js"></script>

	<!-- Page level plugins -->
	<script src="vendor/chart.js/Chart.min.js"></script>

	<!-- Page level custom scripts -->
	<script src="js/demo/chart-area-demo.js"></script>
	<script src="js/demo/chart-pie-demo.js"></script>
</body>
<script> 
$("#email").click(function(){
	$.ajax({
		url : "/rest/resetPassword",
		method : "post",
		data : {"userId" : $("#userId").val()},
		success : function(json){
			console.log(json);
			if(json == "noSuchUser"){
				alert("해당 이메일과 일치하는 유저 정보가 없습니다!");
				return;
			}
			console.log("메일 전송 완료!") 
			$("#email").prop("readonly", true);
			$("#notice").fadeIn(300); 
			setTimeout(function() {
				$("#codeForm").slideDown(500); 
			}, 300); 
		}
	})
}) 

$("#confirmCode").click(function(){
	console.log("코드 검사");
 	$.ajax({
 		url:"/rest/verifyCode",
		method:"post", 
		async : "true",
		success:function(json){
			console.log(json);
			if(json == false){
				alert("코드가 틀렸습니다! 다시 시도하여 주세요. :( ")
				return;
			}
			$("#code").prop("disabled", true);
			$("#confirmCode").prop("disabled", true);
			$('#resend').css("display", "none");  
			
			$("#joinComplete").fadeIn(300);
			setTimeout(function() {
				$("#ok").append("회원이 되신 것을<br>환영합니다 🎆!");
				$("#toLogin").append("로그인 하러 가볼까요?");
			}, 300);
			
			$.ajax({
				url : "/accountRecovery",
				method: "post",
				data : {"userId" : $("#email").val()},
				success : function(){
					console.log("비밀번호 변경");
				}
			})
		},
		fail:function(){
			alert("알 수 없는 에러가 발생 했습니다! 다시 시도하여 주세요 😥");
		}
	})

})  
	
</script>
</html>